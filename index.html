<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Welcome to sitk-ibex’s documentation! &#8212; sitk-ibex 0.5.4.dev3 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css?v=2bf1fcf8" />
    
    <script src="_static/documentation_options.js?v=997dd28c"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Command Line Interface" href="commandline.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="commandline.html" title="Command Line Interface"
             accesskey="N">next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">sitk-ibex 0.5.4.dev3 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Welcome to sitk-ibex’s documentation!</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="welcome-to-sitk-ibex-s-documentation">
<h1>Welcome to sitk-ibex’s documentation!<a class="headerlink" href="#welcome-to-sitk-ibex-s-documentation" title="Link to this heading">¶</a></h1>
<section id="sitk-ibex-aligning-images-acquired-with-the-ibex-microscopy-imaging-technique">
<h2>SITK-IBEX: Aligning images acquired with the IBEX microscopy imaging technique<a class="headerlink" href="#sitk-ibex-aligning-images-acquired-with-the-ibex-microscopy-imaging-technique" title="Link to this heading">¶</a></h2>
<p>This Python package implementation is part of the development of the
Iterative Bleaching Extends Multiplexity (IBEX) imaging technique. It enables
the alignment of multiple cycles of fluorescence images, acquired
using IBEX. A repeated marker is used to register all panels to a
selected panel (in the registration nomenclature this is the fixed image).
After registration all panels are resampled onto the fixed image.</p>
<p>More information about the development of the IBEX technique can be found in
the <a class="reference external" href="https://ibeximagingcommunity.github.io/ibex_imaging_knowledge_base/data_and_software.html">IBEX Imaging Community</a>,  which is a community of researchers who are developing
the  IBEX knowledge-base of reagents, protocols, panels, publications, software,
and datasets.</p>
<p>While this method was developed for a specific imaging protocol, it will likely
work for other sequential protocols that contain a repeated marker.
The registration approach is implemented using the
<a class="reference external" href="https://simpleitk.org">SimpleITK toolkit</a> registration framework.</p>
<p>The key implementation aspects include:</p>
<ol class="arabic simple">
<li><p>Multi-phase based approach with robust initialization.</p></li>
<li><p>Multi-resolution and point sampling.</p></li>
<li><p>Affine transformation model.</p></li>
<li><p>Use of correlation as optimized similarity metric.</p></li>
</ol>
<section id="build-status">
<h3>Build Status<a class="headerlink" href="#build-status" title="Link to this heading">¶</a></h3>
<a class="reference external image-reference" href="https://github.com/niaid/sitk-ibex/actions?query=branch%3A+main+"><img alt="Main Build Status" src="https://github.com/niaid/sitk-ibex/workflows/Python%20Test%20and%20Package/badge.svg?branch=main&amp;event=push" />
</a>
<section id="installation">
<h4>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h4>
<p>The Python module is distributed on <a class="reference external" href="https://pypi.org/project/sitkibex/">PyPI - The Python Package Index</a>. The package can be installed by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">sitkibex</span><span class="p">[</span><span class="n">zarr</span><span class="p">]</span>
</pre></div>
</div>
<p>Wheels from the main branch can be download wheel from <a class="reference external" href="https://github.com/niaid/sitk-ibex/actions?query=branch%3Amain">Github Actions</a> in the
“python-package” artifact.</p>
<p>Dependencies are conventionally specified in <cite>pyproject.toml</cite> and <cite>requirements.txt</cite> and therefore installed as
dependencies when the wheel is installed. This includes the SimpleITK 2.0 requirement. The optional “zarr” dependency
is required for reading OME-NGFF ZARR files, and may be omitted if not needed.</p>
<p>The sitkibex script can also be installed and managed by <a class="reference external" href="https://pypa.github.io/pipx/">pipx</a> or
<a class="reference external" href="https://docs.astral.sh/uv/guides/tools/">uv</a>. For example, to run and automatically install the latest version of
sitkibex, you can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uvx</span> <span class="n">sitkibex</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
</section>
<section id="data">
<h4>Data<a class="headerlink" href="#data" title="Link to this heading">¶</a></h4>
<p>Sample data is available and described on Zenodo:</p>
<a class="reference external image-reference" href="https://doi.org/10.5281/zenodo.4304786"><img alt="https://zenodo.org/badge/DOI/10.5281/zenodo.4304786.svg" src="https://zenodo.org/badge/DOI/10.5281/zenodo.4304786.svg" />
</a>
<p>Any image and transform file format supported by <a class="reference external" href="https://simpleitk.readthedocs.io/en/main/IO.html">SimpleITK’s IO</a>
can be used by sitk-ibex. The NRRD or <a class="reference external" href="https://ngff.openmicroscopy.org/latest/">NGFF</a> image formats, and <cite>txt</cite> transform file
extension are recommended.</p>
</section>
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h4>
<p>The following examples uses CD4 marker channel extracted from the “IBEX4_spleen” data set with ImageJ. The panel 2 is
used as the reference coordinates or the “fixed image”. The other panels are registered then resampled to the fixed
image. The following uses the sitk-ibex command line interface to perform image registration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">sitkibex</span> <span class="n">registration</span> <span class="o">--</span><span class="n">affine</span> <span class="s2">&quot;spleen_panel2.nrrd@CD4 AF594&quot;</span> <span class="s2">&quot;spleen_panel1.nrrd@CD4 AF594&quot;</span> <span class="n">tx_p2_to_p1</span><span class="o">.</span><span class="n">txt</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">sitkibex</span> <span class="n">registration</span> <span class="o">--</span><span class="n">affine</span> <span class="s2">&quot;spleen_panel2.nrrd@CD4 AF594&quot;</span> <span class="s2">&quot;spleen_panel3.nrrd@CD4 AF594&quot;</span> <span class="n">tx_p2_to_p3</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>A quick 2D visualization of the results can be generated with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">sitkibex</span> <span class="n">resample</span> <span class="s2">&quot;spleen_panel2.nrrd@CD4 AF594&quot;</span> <span class="s2">&quot;spleen_panel1.nrrd@CD4 AF594&quot;</span> <span class="n">tx_p2_to_p1</span><span class="o">.</span><span class="n">txt</span> \
       <span class="o">--</span><span class="nb">bin</span> <span class="mi">4</span> <span class="o">--</span><span class="n">fusion</span> <span class="o">--</span><span class="n">projection</span> <span class="o">-</span><span class="n">o</span> <span class="n">spleen_onto_p2_2d_Panel1</span><span class="o">.</span><span class="n">png</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">sitkibex</span> <span class="n">resample</span> <span class="s2">&quot;spleen_panel2.nrrd@CD4 AF594&quot;</span> <span class="s2">&quot;spleen_panel3.nrrd@CD4 AF594&quot;</span> <span class="n">tx_p2_to_p3</span><span class="o">.</span><span class="n">txt</span> \
       <span class="o">--</span><span class="nb">bin</span> <span class="mi">4</span> <span class="o">--</span><span class="n">fusion</span> <span class="o">--</span><span class="n">projection</span> <span class="o">-</span><span class="n">o</span> <span class="n">spleen_onto_p2_2d_Panel3</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<p>The above image fusion renders the fixed image as magenta and the moving as cyan, so when the two are aligned the
results are white.</p>
<p>Then apply the registration transform by resampling all channels of the the input images onto panel 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">sitkibex</span> <span class="n">resample</span> <span class="s2">&quot;spleen_panel2.nrrd@CD4 AF594&quot;</span> <span class="n">spleen_panel2</span><span class="o">.</span><span class="n">nrrd</span> <span class="n">tx_p2_to_p1</span><span class="o">.</span><span class="n">txt</span> \
       <span class="o">-</span><span class="n">o</span> <span class="n">spleen_onto_p2_panel1</span><span class="o">.</span><span class="n">nrrd</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">sitkibex</span> <span class="n">resample</span> <span class="s2">&quot;spleen_panel2.nrrd@CD4 AF594&quot;</span> <span class="n">spleen_panel3</span><span class="o">.</span><span class="n">nrrd</span> <span class="n">tx_p2_to_p3</span><span class="o">.</span><span class="n">txt</span> \
       <span class="o">-</span><span class="n">o</span> <span class="n">spleen_onto_p2_panel3</span><span class="o">.</span><span class="n">nrrd</span>
</pre></div>
</div>
</section>
<section id="additional-example">
<h4>Additional Example<a class="headerlink" href="#additional-example" title="Link to this heading">¶</a></h4>
<p>Additional sample data:</p>
<a class="reference external image-reference" href="https://doi.org/10.5281/zenodo.4632320"><img alt="https://zenodo.org/badge/DOI/10.5281/zenodo.4632320.svg" src="https://zenodo.org/badge/DOI/10.5281/zenodo.4632320.svg" />
</a>
<p>The sample Imaris files can be converted to OME-NGFF ZARR with
<a class="reference external" href="https://github.com/glencoesoftware/bioformats2raw/releases">bioformats2raw</a>. The ims files contains one series, and
for simplicity, the structure is generated without a series index in the hierarchy with the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bioformats2raw</span>  <span class="o">--</span><span class="n">series</span> <span class="mi">0</span> <span class="o">--</span><span class="n">scale</span><span class="o">-</span><span class="nb">format</span><span class="o">-</span><span class="n">string</span> <span class="s1">&#39;%2$d/&#39;</span>  <span class="n">Human_Spleen_Panel1</span><span class="o">.</span><span class="n">ims</span> <span class="n">Human_Spleen_Panel1</span><span class="o">.</span><span class="n">zarr</span>
<span class="n">bioformats2raw</span>  <span class="o">--</span><span class="n">series</span> <span class="mi">0</span> <span class="o">--</span><span class="n">scale</span><span class="o">-</span><span class="nb">format</span><span class="o">-</span><span class="n">string</span> <span class="s1">&#39;%2$d/&#39;</span>  <span class="n">Human_Spleen_Panel2</span><span class="o">.</span><span class="n">ims</span> <span class="n">Human_Spleen_Panel2</span><span class="o">.</span><span class="n">zarr</span>
<span class="n">bioformats2raw</span>  <span class="o">--</span><span class="n">series</span> <span class="mi">0</span> <span class="o">--</span><span class="n">scale</span><span class="o">-</span><span class="nb">format</span><span class="o">-</span><span class="n">string</span> <span class="s1">&#39;%2$d/&#39;</span>  <span class="n">Human_Spleen_Panel2</span><span class="o">.</span><span class="n">ims</span> <span class="n">Human_Spleen_Panel3</span><span class="o">.</span><span class="n">zarr</span>
</pre></div>
</div>
<p>These images will be registered based on the common “Hoechst”. The name of the channels are lost in this conversion from
Imaris to OME-NGFF ZARR. Some conversions produce “omera” metadata in the ZARR file which contains channel labels, which
can be used. When the channel labels are unavailable, the channel index can be used such as the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">sitkibex</span> <span class="n">registration</span> <span class="o">--</span><span class="n">affine</span> <span class="s2">&quot;Human_Spleen_Panel2.zarr@3&quot;</span> <span class="s2">&quot;Human_Spleen_Panel1.zarr@2&quot;</span> <span class="n">tx_p2_to_p1</span><span class="o">.</span><span class="n">txt</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">sitkibex</span> <span class="n">registration</span> <span class="o">--</span><span class="n">affine</span> <span class="s2">&quot;Human_Spleen_Panel2.zarr@3&quot;</span> <span class="s2">&quot;Human_Spleen_Panel3.zarr@4&quot;</span> <span class="n">tx_p2_to_p3</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>The quick 2D visualization can be run similarly to the NRRD example. The OME-NGFF ZARR files are not supported for
writing, so the resample command can produce NRRD files as well.</p>
</section>
<section id="how-to-cite">
<h4>How to Cite<a class="headerlink" href="#how-to-cite" title="Link to this heading">¶</a></h4>
<p>If you use the SITK-IBEX package in your work, please cite us:</p>
<blockquote>
<div><p>A. J. Radtke, E. F. Kandov, B. C. Lowekamp, E. Speranza, C. Chu,
A. Gola, N. Thakur, R. Shih, L. Yao, Z. R. Yaniv, R. Beuschel,
J. Kabat, J. Croteau, J. Davis, J. M. Hernandez, R. N. Germain
“IBEX - A versatile multi-plex optical imaging approach
for deep phenotyping and spatial analysis of cells in complex tissues”,
Proc Natl Acad Sci, 117(52):33455-33465, 2020, doi:<a class="reference external" href="https://www.pnas.org/doi/10.1073/pnas.2018488117">10.1073/pnas.2018488117</a>.</p>
</div></blockquote>
</section>
<section id="documentation">
<h4>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h4>
<p>The published Sphinx documentation is available here: <a class="reference external" href="https://niaid.github.io/sitk-ibex/">https://niaid.github.io/sitk-ibex/</a></p>
<p>The main built Sphinx documentation is available for download from
<a class="reference external" href="https://github.com/niaid/sitk-ibex/actions?query=branch%3Amain">Github Actions</a> under the build as “sphinx-docs”.</p>
</section>
<section id="contact">
<h4>Contact<a class="headerlink" href="#contact" title="Link to this heading">¶</a></h4>
<p>Please use the <a class="reference external" href="https://github.com/niaid/sitk-ibex">GitHub Issues</a> for support and code issues related to the sitk-ibex project.</p>
</section>
<section id="command-line-interface-reference">
<h4>Command Line Interface Reference<a class="headerlink" href="#command-line-interface-reference" title="Link to this heading">¶</a></h4>
<p>Documentation for command line usage of the Python module.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="commandline.html">Command Line Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="commandline.html#sitkibex">sitkibex</a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="api-reference">
<h4>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading">¶</a></h4>
<p>Documentation for directly using the Python functions.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#sitkibex.registration"><code class="docutils literal notranslate"><span class="pre">registration()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#sitkibex.resample"><code class="docutils literal notranslate"><span class="pre">resample()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#sitkibex.globals.default_random_seed"><code class="docutils literal notranslate"><span class="pre">default_random_seed</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#sitkibex.globals.logger"><code class="docutils literal notranslate"><span class="pre">logger</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#sitkibex.io.im_read_channel"><code class="docutils literal notranslate"><span class="pre">im_read_channel()</span></code></a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="development">
<h4>Development<a class="headerlink" href="#development" title="Link to this heading">¶</a></h4>
<p>The required packages for development are specified in <cite>requirements-dev.txt</cite>. The sitk-ibex project must be install for
it to function properly. Specifically, because semantic versioning is done with <cite>setuptools-scm</cite> it must be installed. To setup for development:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">-</span><span class="n">dev</span><span class="o">.</span><span class="n">txt</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">editable</span> <span class="o">.</span>
</pre></div>
</div>
<p>New contributions must come from pull requests on GitHub. New features should start as local branch with a name
starting with “feature-” followed by a description. After changes, verify flake8 and the tests pass
without warnings or errors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">flake8</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pytest</span>
</pre></div>
</div>
<p>Since the repository is internal, the feature branch needs to be
pushed to the <em>upstream</em> repository. Next a pull request is made against main, where the CI will automatically run
flake8, pytest and sphinx. When merging the branch with rebased onto the origin, and the feature branch is deleted.</p>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="#">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Welcome to sitk-ibex’s documentation!</a><ul>
<li><a class="reference internal" href="#sitk-ibex-aligning-images-acquired-with-the-ibex-microscopy-imaging-technique">SITK-IBEX: Aligning images acquired with the IBEX microscopy imaging technique</a><ul>
<li><a class="reference internal" href="#build-status">Build Status</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#data">Data</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#additional-example">Additional Example</a></li>
<li><a class="reference internal" href="#how-to-cite">How to Cite</a></li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
<li><a class="reference internal" href="#contact">Contact</a></li>
<li><a class="reference internal" href="#command-line-interface-reference">Command Line Interface Reference</a></li>
<li><a class="reference internal" href="#api-reference">API Reference</a></li>
<li><a class="reference internal" href="#development">Development</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="commandline.html"
                          title="next chapter">Command Line Interface</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="commandline.html" title="Command Line Interface"
             >next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">sitk-ibex 0.5.4.dev3 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Welcome to sitk-ibex’s documentation!</a></li> 
      </ul>
    </div>
        <!-- cutom footer here -->

  </body>
</html>